<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Trung t√¢m Ngo·∫°i ng·ªØ Fabulous Mekong - FME</title>
  <link rel="stylesheet" href="css/typo/typo.css" />
  <link rel="stylesheet" href="css/hc-canvas-luckwheel.css" />
  <style>
    .hc-luckywheel {
      position: relative;
      top: 50%;
      left: 50%;
      transform: translateX(-50%) translateY(35%);
    }
  </style>
</head>

<body class="bg" style="  height: 100vh !important;
    width: 100% !important;">

  <div class="wheel-container" id="content">
    <div style="position: relative;">
      <h2 class="wheel-title">Th·ª≠ v·∫≠n may</br>rinh ngay ph·∫ßn th∆∞·ªüng</h2>
      <p class="wheel-title-main">C√ôNG M.I.A</p>
      <h2 class="wheel-title-subtitle">Nh·∫•n ƒë·ªÉ quay, nh·∫≠n li·ªÅn tay qu√† t·∫∑ng h·∫•p d·∫´n</h2>
    </div>
    <div class="typo" id="wrapper">
      <div id="luckywheel" class="hc-luckywheel">
        <div style="position: relative;">
          <div class="hc-luckywheel-container">
            <canvas class="hc-luckywheel-canvas" width="500px" height="500px">V√≤ng Xoay May M·∫Øn</canvas>
          </div>
          <div style="position: relative; margin: 15px;">
            <img src="./assests/wheel.png" alt="" style="position: absolute;" class="wheel">
          </div>
        </div>
        <div class="hc-luckywheel-pointer"></div>
        <a class="hc-luckywheel-btn" href="javascript:;">
          <p>
            B·∫ÆT<br />ƒê·∫¶U<br />CH∆†I
          </p>
        </a>
      </div>
    </div>
  </div>
  </div>
  <h2 class="footer-title" id="footer">
    NHANH TAY L·∫§Y NGAY QU√Ä T·∫∂NG S·ªê L∆Ø·ª¢NG C√ì H·∫†N C√ôNG M.I.A
  </h2>
  <!--Giao di·ªán nh·∫≠n ph·∫ßn th∆∞·ªüng r·ªìi -->
  <!-- <div class="overlay" id="popupOverlay">
      <div class="popup">
        <img src="./assests/Icon TruÃÅng thuÃõoÃõÃâng.png" alt="üéâ" class="win-icon">
        <div class="title">Ch√∫c m·ª´ng b·∫°n nh·∫≠n ƒë∆∞·ª£c</div>
        <div class="prize" id="prizeText"></div>
        <img id="prizeImage" src="" alt="MIA Device">
        <a href="#" class="btn" onclick="closeModal()">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ nh·∫≠n qu√†</a>
        <div class="subtitle">Tr∆∞·ªùng h·ª£p xu·∫•t hi·ªán 2 gi·∫£i th∆∞·ªüng c√πng m√£ (code) ho·∫∑c<br />m√£ kh√¥ng h·ª£p l·ªá, gi·∫£i th∆∞·ªüng
          s·∫Ω ƒë∆∞·ª£c xem l√† kh√¥ng h·ª£p l·ªá.</div>
      </div>
    </div> -->
  <!--Giao di·ªán ƒë√£ c√≥ qu√† r·ªìi -->

  <div class="overlay" id="popupOverlay">
    <div class="popup">
      <img src="./assests/Icon heÃÇÃÅt luÃõoÃõÃ£t quay.png" alt="üéâ" class="win-icon">
      <div class="title" id="title"></div>
      <img id="prizeImage" src="" alt="MIA Device">
      <a class="btn" onclick="closeModal()">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ nh·∫≠n qu√†</a>
      <div class="subtitle">Tr∆∞·ªùng h·ª£p xu·∫•t hi·ªán 2 gi·∫£i th∆∞·ªüng c√πng m√£ (code) ho·∫∑c<br />m√£ kh√¥ng h·ª£p l·ªá, gi·∫£i th∆∞·ªüng
        s·∫Ω ƒë∆∞·ª£c xem l√† kh√¥ng h·ª£p l·ªá.</div>
    </div>
  </div>
  <audio allow="autoplay" loop src="./assests/nhacNen.mp3" id="wheel-background-music"></audio>
  <audio src="./assests//nhacQuaySo.mp3" id="wheel-rotate-music"></audio>
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hc-canvas-luckwheel@1.0.2/dist/hc-canvas-luckwheel.min.js"></script>
  <script src="js/hc-canvas-luckwheel.js"></script>
  <script>
    var isPercentage = true;

    const prizes = [
      {
        text: "Gi·∫£m 20% D·ªãch V·ª• Peel",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/Voucher gi·∫£m 20_ peel da.png'
      },
      {
        text: "T√∫i Tote",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/T√∫i Tote.png'
      },
      {
        text: "T√∫i S√°p 100gram",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/T√∫i s√°p 100gr.png'
      },
      {
        text: "Discount 50% Peel",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/Voucher gi·∫£m 50_ peel.png'
      },
      {
        text: "Free 100% D·ªãch V·ª• Da",
        number: 10,
        percentpage: 0.05,
        img: './assests/gifts/Voucher free d·ªãch v·ª• da.png'
      },
      {
        text: "Tri·ªát Tr·∫£i Nghi·ªám 1K",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/Tri·ªát tr·∫£i nghi·ªám 1K.png'
      },
      {
        text: "Gi·∫£m 30% C·∫•y Tr·∫Øng Enzyme 5D",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/Voucher gi·∫£m 30_ c·∫•y tr·∫Øng 5D.png'
      },
      {
        text: "T√∫i Tote",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/T√∫i Tote.png'
      },
      {
        text: "1 Bu·ªïi Wax N√°ch Free",
        number: 10,
        percentpage: 0.1,
        img: './assests/gifts/Voucher Wax n√°ch free_1.png'
      },
      {
        text: "Wax 9K",
        number: 10,
        percentpage: 0.05,
        img: './assests/gifts/Voucher wax n√°ch 9K.png'
      },
      {
        text: "Tri·ªát N√°ch N·ªØ 499K Nam 899K",
        number: 10,
        percentpage: 0.05,
        img: './assests/gifts/M√°y tri·ªát l√¥ng.png'
      },
      {
        text: "Gi·∫£m 30% D·ªãch V·ª• Da",
        number: 10,
        percentpage: 0.05,
        img: './assests/gifts/Voucher gi·∫£m 30_ d·ªãch v·ª• da.png'
      },
    ];

    function openModal(data) {
      // C·∫≠p nh·∫≠t n·ªôi dung modal
      if (data === null) {
        document.getElementById("prizeText").textContent = "Ch∆∞∆°ng tr√¨nh k·∫øt th√∫c: ƒê√£ h·∫øt ph·∫ßn th∆∞·ªüng!";
        document.getElementById("prizeImage").src = ""; // X√≥a h√¨nh ·∫£nh n·∫øu kh√¥ng c√≥ ph·∫ßn th∆∞·ªüng
      } else if (data === "Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau") {
        document.getElementById("prizeText").textContent = "B·∫°n kh√¥ng tr√∫ng th∆∞·ªüng. Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau!";
        document.getElementById("prizeImage").src = "../public/assests/sorry.png"; // H√¨nh ·∫£nh kh√¥ng tr√∫ng
      } else {
        // N·∫øu tr√∫ng th∆∞·ªüng, c·∫≠p nh·∫≠t ph·∫ßn th∆∞·ªüng
        //document.getElementById("prizeText").textContent = data.text;
        document.getElementById("title").innerHTML = `B·∫°n ƒë√£ nh·∫≠n ƒë∆∞·ª£c\n<p class="product-name">${data.text}</p>\n<p style="margin:0px";>t·ª´ M.I.A r·ªìi, h√£y ƒëi·ªÅn th√¥ng tin</p><p style="margin:0px";>ƒë·ªÉ nh·∫≠n qu√† ngay nh√©!</p>`;

        if (data.text == 'T√∫i Tote' || data.text == 'T√∫i S√°p 100gram' || data.text == 'Tri·ªát N√°ch N·ªØ 499K Nam 899K') {
          document.getElementById("prizeImage").src = data.img;
        } else {
          document.getElementById("prizeImage").classList.add("rotate");
          document.getElementById("prizeImage").src = data.img;
        }

      }

      document.getElementById("popupOverlay").style.display = "flex";
      document.getElementById("content").classList.add("blur");
      document.getElementById("footer").classList.add("blur");
    }

    function closeModal() {
      // ·∫®n modal v√† x√≥a l·ªõp l√†m m·ªù
      document.getElementById("prizeImage").classList.remove("rotate");
      document.getElementById("popupOverlay").style.display = "none";
      document.getElementById("content").classList.remove("blur");
      document.getElementById("footer").classList.remove("blur");

    }

    document.addEventListener(
      "DOMContentLoaded",
      function () {
        hcLuckywheel.init({
          id: "luckywheel",
          config: function (callback) {
            callback && callback(prizes);
          },
          mode: "text",
          getPrize: function (callback) {
            var rand = randomIndex(prizes);
            var chances = rand;
            callback && callback([rand, chances]);
          },
          gotBack: function (data) {
            confetti({
              zIndex: 99999,
              particleCount: 500,
              startVelocity: 30,
              spread: 360,
            });
            if (data == null) {
              Swal.fire(
                'Ch∆∞∆°ng tr√¨nh k·∫øt th√∫c',
                'ƒê√£ h·∫øt ph·∫ßn th∆∞·ªüng',
                'error'
              )
            } else if (data == 'Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau') {
              Swal.fire(
                'B·∫°n kh√¥ng tr√∫ng th∆∞·ªüng',
                data,
                'error'
              )
            } else {
              openModal(data)
            }
          }
        });

        // Optional: Automatically play background music on page load
        // Swal.fire(
        //   {
        //     title: "Ch√†o m·ª´ng </br> c√°c T√¢n sinh vi√™n </br> Tr∆∞·ªùng B√°ch Khoa",
        //     html: "C√πng tham gia v√≤ng quay may m·∫Øn ƒë·ªÉ nh·∫≠n nh·ªØng ph·∫ßn qu√† gi√° tr·ªã t·ª´ FME nh√©!",
        //     confirmButtonText: 'Tham gia ngay'
        //   }
        // ).then(() => {
        //   document.querySelector("#wheel-background-music").play()
        // })
      },
      false
    );

    function randomIndex(prizes) {
      console.log(prizes);
      document.querySelector("#wheel-background-music").pause()
      document.querySelector("#wheel-rotate-music").play()

      // Check if all prizes are exhausted
      var exhausted = prizes.every(prize => prize.number === 0);
      if (exhausted) {
        return null;
      }

      if (isPercentage) {
        let rand = Math.random();
        let cumulative = 0;
        let prizeIndex = null;

        for (let i = 0; i < prizes.length; i++) {
          cumulative += prizes[i].percentpage;
          if (rand < cumulative) {
            prizeIndex = i;
            break;
          }
        }

        // If no prize is selected due to floating point precision, assign the last prize
        if (prizeIndex === null) {
          prizeIndex = prizes.length - 1;
        }

        // Check if the selected prize is still available
        if (prizes[prizeIndex].number > 0) {
          prizes[prizeIndex].number -= 1;
          return prizeIndex;
        } else {
          // If the selected prize is exhausted, recursively try again
          return randomIndex(prizes);
        }
      } else {
        // Random selection without percentage
        var availablePrizes = prizes.filter(prize => prize.number > 0);
        if (availablePrizes.length === 0) {
          return null;
        }
        var rand = Math.floor(Math.random() * availablePrizes.length);
        var selectedPrize = availablePrizes[rand];
        var prizeIndex = prizes.indexOf(selectedPrize);
        prizes[prizeIndex].number -= 1;
        return prizeIndex;
      }
    }
  </script>

</body>

</html>