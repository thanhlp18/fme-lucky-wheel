<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta property="og:title" content="M.I.A - Th·ª≠ v·∫≠n may rinh ngay ph·∫ßn th∆∞·ªüng" />
  <meta property="og:description" content="Nh·∫•n ƒë·ªÉ quay, nh·∫≠n li·ªÅn tay qu√† t·∫∑ng h·∫•p d·∫´n c√πng M.I.A" />
  <meta property="og:image"
    content="https://miawaxing.vn/wp-content/uploads/2022/09/299736667_831246341584784_346590775965623132_n-scaled.jpeg" />
  <meta property="og:url" content="https://miawaxing.vn/" />
  <meta property="og:type" content="website" />
  <title>M.I.A - Th·ª≠ v·∫≠n may rinh ngay ph·∫ßn th∆∞·ªüng</title>
  <link rel="stylesheet" href="css/typo/typo.css" />
  <link rel="stylesheet" href="css/hc-canvas-luckwheel.css" />
  <style>
    .hc-luckywheel {
      position: relative;
      top: 50%;
      left: 50%;
      transform: translateX(-50%) translateY(35%);
    }

    form {
      max-width: 600px;
      height: 75vh;
      overflow-y: auto;
      margin: 50px auto;
      padding: 20px 30px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      text-align: left;
      font-family: "Main Font", sans-serif;

    }

    h2 {
      font-size: 1.5em;
      font-weight: 500;
      color: #202124;
      text-align: center;
      margin-bottom: 20px;
    }

    small {
      display: block;
      font-size: 0.9em;
      color: #5f6368;
      margin-bottom: 10px;
    }

    fieldset {
      border: none;
      margin-bottom: 20px;
      padding: 0;
    }

    legend {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 1em;
      color: #202124;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"],
    input[type="date"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      font-size: 1em;
      background-color: #fff;
      color: #202124;
      box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    input[type="radio"],
    input[type="checkbox"] {
      margin-right: 10px;
    }

    .form-group {
      margin-bottom: 10px;
    }

    .radio,
    .checkbox {
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }

    button[type="submit"] {
      background-color: #4285f4;
      color: white;
      font-size: 1em;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
    }

    button[type="submit"]:hover {
      background-color: #357ae8;
    }

    ul {
      padding-left: 20px;
      color: #5f6368;
      font-size: 0.9em;
    }

    ul li {
      margin-bottom: 5px;
    }

    .spin-again-btn {
      background: #F5CB41;

      font-family: "Footer", sans-serif;
      color: #333;
      font-size: 28px;
      font-weight: bold;
      border-radius: 10px;
      text-decoration: none;
      padding: 2px 16px;
      cursor: pointer;
      width: fit-content;
      margin: 0px auto;
      margin-top: 50px;
    }

    .spin-again-btn:hover {
      background: #f5b700;
    }

    #preSpinForm .help-block {
      margin-top: 10px !important;
      margin-bottom: 0px !important;
    }

    .spin-counter {
      text-align: center;
      margin: 20px 0;
      font-size: 18px;
      font-weight: bold;
      color: #4285f4;
    }
  </style>
</head>

<body class="bg" style="height: 100vh !important; width: 100% !important;">
  <div class="main-content">
    <div class="img-section">
      <img src="./assests/slogan.png" alt="" class="top-img-content">
      <div class="bottom-content">
        <img src="./assests/banner.png" alt="" class="bottom-img-content">
      </div>
    </div>
    <div class="wheel-container" id="content" style="margin-bottom: 100px;">
      <form id="preSpinForm" style="display: block;">
        <h2>Nh·∫≠p th√¥ng tin ƒë·ªÉ b·∫Øt ƒë·∫ßu</h2>
        <fieldset>
          <legend>T√äN KH√ÅCH H√ÄNG</legend>
          <div class="form-group">
            <p class="help-block">V√≠ d·ª•: Nguy·ªÖn Th·ªã Kim</p>
            <input type="text" id="userName" name="userName" class="form-control" required>
          </div>
        </fieldset>
        <fieldset>
          <legend>S·ªê ƒêI·ªÜN THO·∫†I X√ÅC NH·∫¨N</legend>
          <div class="form-group">
            <input type="tel" id="phoneNumber" name="phoneNumber" class="form-control" required pattern="[0-9]{10}">
          </div>
        </fieldset>
        <fieldset>
          <legend>S·ªê L∆Ø·ª¢T QUAY</legend>
          <div class="form-group">
            <input type="number" id="spinLimit" name="spinLimit" class="form-control" required min="1">
          </div>
        </fieldset>
        <button type="submit" class="btn btn-primary">B·∫Øt ƒë·∫ßu quay</button>
      </form>
      <div class="typo" id="wrapper" style="display: none;">
        <div id="luckywheel" class="hc-luckywheel">
          <div style="position: relative;">
            <div class="hc-luckywheel-container">
              <canvas class="hc-luckywheel-canvas" width="500px" height="500px">V√≤ng Xoay May M·∫Øn</canvas>
            </div>
            <div style="position: relative; margin: 15px;">
              <img src="./assests/wheel.png" alt="" style="position: absolute;" class="wheel">
            </div>
          </div>
          <div class="hc-luckywheel-pointer"></div>
          <a class="hc-luckywheel-btn" href="javascript:;">
            <p>B·∫ÆT<br />ƒê·∫¶U<br />CH∆†I</p>
          </a>
        </div>
      </div>
    </div>
  </div>
  <div class="overlay" id="popupOverlay">
    <div class="popup">
      <div id="popupInformation-1-1" style="display: none;">
        <img src="./assests/Icon TruÃÅng thuÃõoÃõÃâng.png" alt="üéâ" class="win-icon">
        <div class="title">Ch√∫c m·ª´ng b·∫°n nh·∫≠n ƒë∆∞·ª£c</div>
        <div class="prize" id="prizeText"></div>
        <img id="prizeImage" src="" alt="MIA Device">
        <a class="btn" id="fillFormBtn" style="display: none;" onclick="showForm()">ƒêi·ªÅn th√¥ng tin ƒë·ªÉ nh·∫≠n qu√†</a>
        <a class="spin-again-btn" id="spinAgainBtn" style="display: none;" onclick="spinAgain()">Quay ti·∫øp</a>
      </div>
      <div class="subtitle" id="popupInformation-1-2" style="display: none;">Tr∆∞·ªùng h·ª£p xu·∫•t hi·ªán 2 gi·∫£i th∆∞·ªüng c√πng m√£
        (code) ho·∫∑c<br />m√£ kh√¥ng h·ª£p l·ªá, gi·∫£i th∆∞·ªüng s·∫Ω ƒë∆∞·ª£c xem l√† kh√¥ng h·ª£p l·ªá.</div>
      <form
        action="https://docs.google.com/forms/d/e/1FAIpQLScgNbukrIoPBcyBezZZzxooIhWFuJhP3Eh445JJO2ggVakGiA/formResponse"
        target="_self" id="bootstrapForm-1" method="POST" style="display: none;">
        <fieldset>
          <h2>ƒêI·ªÄN TH√îNG TIN NH·∫¨N QU√Ä 21.12</h2>
          <small>
            Qu√Ω kh√°ch h√†ng l∆∞u √Ω:
            <ul>
              <li>Ph·∫ßn qu√† h·ª£p l·ªá l√† ph·∫ßn qu√† ƒë∆∞·ª£c quay 1 l·∫ßn duy nh·∫•t cho m·ªói ID kh√°ch h√†ng, M.I.A lo·∫°i b·ªè nh·ªØng ph·∫ßn
                qu√† c√≥ tr√πng ID v·ªõi ph·∫ßn qu√† ƒë·∫ßu ti√™n m√† kh√°ch h√†ng nh·∫≠n ƒë∆∞·ª£c</li>
              <li>Ph·∫ßn qu√† h·ª£p l·ªá l√† ph·∫ßn qu√† c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin kh√°ch h√†ng, trong tr∆∞·ªùng h·ª£p chuy√™n vi√™n M.I.A kh√¥ng
                th·ªÉ li√™n l·∫°c ƒë∆∞·ª£c v·ªõi kh√°ch h√†ng tr√∫ng th∆∞·ªüng b·ªüi nguy√™n nh√¢n: s·ªë ƒëi·ªán tho·∫°i kh√¥ng ch√≠nh ch·ªß ho·∫∑c kh√¥ng
                li√™n l·∫°c ƒë∆∞·ª£c; kh√°ch h√†ng kh√¥ng th·ªÉ ƒë·∫øn nh·∫≠n trong th·ªùi gian quy ƒë·ªãnh; v.v... ph·∫ßn qu√† s·∫Ω t√≠nh l√† kh√¥ng
                h·ª£p l·ªá.</li>
              <li>M·ªói ph·∫ßn th∆∞·ªüng s·∫Ω c√≥ c√°ch th·ª©c trao gi·∫£i v√† th·ªùi h·∫°n s·ª≠ d·ª•ng kh√°c nhau, qu√Ω kh√°ch vui l√≤ng ƒë·ªÉ √Ω ƒëi·ªán
                tho·∫°i ƒë·ªÉ ƒë∆∞·ª£c chuy√™n vi√™n M.I.A h∆∞·ªõng d·∫´n nh·∫≠n th∆∞·ªüng theo ƒë√∫ng quy tr√¨nh.</li>
              <li>M.I.A s·∫Ω kh√¥ng gi·∫£i quy·∫øt b·∫•t k√¨ ph√°t sinh n√†o trong qu√° tr√¨nh kh√°ch h√†ng tham gia quay th∆∞·ªüng.</li>
            </ul>
          </small>
        </fieldset>
        <fieldset>
          <legend for="1399457082">T√äN KH√ÅCH H√ÄNG</legend>
          <div class="form-group">
            <p class="help-block">V√≠ d·ª•: Nguy·ªÖn Th·ªã Kim</p>
            <input id="919986610" type="text" name="entry.919986610" class="form-control" required>
          </div>
        </fieldset>
        <fieldset>
          <legend for="407916102">NƒÇM SINH</legend>
          <div class="form-group">
            <input type="date" id="471289509_date_1" placeholder="12/21/2024" class="form-control" required>
          </div>
        </fieldset>
        <fieldset>
          <legend for="70487533">GI·ªöI T√çNH</legend>
          <div class="form-group">
            <p class="help-block">Gi·ªõi t√≠nh ƒë∆∞·ª£c ghi tr√™n gi·∫•y t·ªù t√πy th√¢n c·ªßa b·∫°n</p>
            <div class="radio">
              <label>
                <input type="radio" name="entry.680423588" value="NAM" required>
                NAM
              </label>
            </div>
            <div class="radio">
              <label>
                <input type="radio" name="entry.680423588" value="N·ªÆ" required>
                N·ªÆ
              </label>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend for="1414010662">S·ªê ƒêI·ªÜN THO·∫†I X√ÅC NH·∫¨N</legend>
          <div class="form-group">
            <input id="1469647055" type="text" name="entry.1469647055" class="form-control" required>
          </div>
        </fieldset>
        <fieldset>
          <legend for="517982298">EMAIL (n·∫øu c√≥)</legend>
          <div class="form-group">
            <p class="help-block">H√£y ƒëi·ªÅn email ƒë·ªÉ chuy√™n vi√™n ki·ªÉm tra th√¥ng tin c·ªßa b·∫°n d·ªÖ d√†ng v√† th√¥ng b√°o nh·∫≠n
              th∆∞·ªüng s·ªõm nh·∫•t cho b·∫°n nh√©!</p>
            <input id="881129091" type="text" name="entry.881129091" class="form-control">
          </div>
        </fieldset>
        <fieldset>
          <legend for="1922738138">PH·∫¶N QU√Ä NH·∫¨N ƒê∆Ø·ª¢C</legend>
          <div class="form-group">
            <input id="151499827-1" type="text" name="entry.151499827" class="form-control" readonly>
          </div>
        </fieldset>
        <fieldset>
          <legend for="118160036">B·∫†N C√ì QUAN T√ÇM ƒê·∫æN D·ªäCH V·ª§ N√ÄO SAU ƒê√ÇY HAY KH√îNG?</legend>
          <div class="form-group">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="1. ƒêi·ªÅu tr·ªã da m·ª•n">
                1. ƒêi·ªÅu tr·ªã da m·ª•n
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="2. X√≥a n√°m / t√†n nhang">
                2. X√≥a n√°m / t√†n nhang
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="3. Wax l√¥ng">
                3. Wax l√¥ng
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="4. Tri·ªát l√¥ng">
                4. Tri·ªát l√¥ng
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="5. Massage body nh·ª©c m·ªèi">
                5. Massage body nh·ª©c m·ªèi
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="6. G·ªôi ƒë·∫ßu th∆∞ gi√£n - d∆∞·ª°ng sinh">
                6. G·ªôi ƒë·∫ßu th∆∞ gi√£n - d∆∞·ª°ng sinh
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.16258585" value="7. T·∫Øm tr·∫Øng body">
                7. T·∫Øm tr·∫Øng body
              </label>
            </div>
          </div>
        </fieldset>
        <fieldset>
          <legend for="504332009">B·∫†N BI·∫æT ƒê·∫æN M.I.A QUA ƒê√ÇU?</legend>
          <div class="form-group">
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.1078723396" value="M·∫°ng x√£ h·ªôi (Facebook, Tiktok,...)">
                M·∫°ng x√£ h·ªôi (Facebook, Tiktok,...)
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.1078723396" value="Qu·∫£ng c√°o facebook">
                Qu·∫£ng c√°o facebook
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.1078723396" value="B·∫°n b√® gi·ªõi thi·ªáu">
                B·∫°n b√® gi·ªõi thi·ªáu
              </label>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" name="entry.1078723396" value="Ch∆∞a nghe qua tr∆∞·ªõc ƒë√≥">
                Ch∆∞a nghe qua tr∆∞·ªõc ƒë√≥
              </label>
            </div>
          </div>
        </fieldset>
        <input type="hidden" name="fvv" value="1">
        <input type="hidden" name="fbzx" value="-6535336632366687464">
        <input type="hidden" name="pageHistory" value="0">
        <input class="btn btn-primary" type="submit" value="Submit" style="margin: auto; width: 100%;">
      </form>
    </div>
  </div>
  <div class="overlay" id="popupOverlayOutOfTurn">
    <div class="popup">
      <div id="popupInformation-2-1">
        <img src="./assests/Icon heÃÇÃÅt luÃõoÃõÃ£t quay.png" alt="üéâ" class="win-icon">
        <div class="title">H·∫æT L∆Ø·ª¢T QUAY</div>
        <div class="subtitle">R·∫•t ti·∫øc, b·∫°n ƒë√£ h·∫øt l∆∞·ª£t quay. Vui l√≤ng li√™n h·ªá nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ th√™m!</div>
        <a class="btn" onclick="closeModal()">ƒê√≥ng</a>
      </div>
    </div>
  </div>
  <div class="overlay" id="popupOverlayOutOfQuantity">
    <div class="popup">
      <div id="popupInformation-2-1">
        <img src="./assests/Icon heÃÇÃÅt luÃõoÃõÃ£t quay.png" alt="üéâ" class="win-icon">
        <div class="title">H·∫æT PH·∫¶N QU√Ä</div>
        <div class="subtitle">R·∫•t ti·∫øc, s·ªë l∆∞·ª£ng ph·∫ßn qu√† ƒë√£ h·∫øt. Vui l√≤ng li√™n h·ªá nh√¢n vi√™n ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ th√™m!</div>
        <a class="btn" onclick="closeModal()">ƒê√≥ng</a>
      </div>
    </div>
  </div>
  <audio allow="autoplay" loop src="./assests/nhacNen.mp3" id="wheel-background-music"></audio>
  <audio src="./assests/MIA WAX LOÃÇNG.mp3" id="wheel-rotate-music"></audio>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js"
    integrity="sha256-2Pjr1OlpZMY6qesJM68t2v39t+lMLvxwpa8QlRjJroA=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script src="js/hc-canvas-luckwheel.js"></script>
  <script src="js/form-handler.js" defer></script>
  <script>
    var isPercentage = true;
    const prizes = [
      { text: "Voucher gi·∫£m gi√° 50k", number: 50, percentpage: 0.35, img: './assests/gifts/voucher50k.png' },
      { text: "Voucher gi·∫£m gi√° 100k", number: 40, percentpage: 0.25, img: './assests/gifts/voucher100k.png' },
      { text: "Voucher gi·∫£m gi√° 200k", number: 30, percentpage: 0.15, img: './assests/gifts/voucher200k.png' },
      { text: "Voucher gi·∫£m gi√° 300k", number: 20, percentpage: 0.1, img: './assests/gifts/voucher300k.png' },
      { text: "Voucher gi·∫£m gi√° 500k", number: 10, percentpage: 0.1, img: './assests/gifts/voucher500k.png' },
      { text: "Voucher gi·∫£m gi√° 50k", number: 45, percentpage: 0.35, img: './assests/gifts/voucher50k.png' },
      { text: "Voucher gi·∫£m gi√° 1000k", number: 5, percentpage: 0.05, img: './assests/gifts/voucher1000k.png' },
      { text: "Voucher gi·∫£m gi√° 3999k", number: 0, percentpage: 0, img: './assests/gifts/voucher3999k.png' },
    ];
    window.prizes = prizes;

    function getSpinData() {
      return JSON.parse(sessionStorage.getItem("spinData")) || {};
    }

    function setSpinData(data) {
      sessionStorage.setItem("spinData", JSON.stringify(data));
    }

    function getCurrentUserSpins() {
      const phoneNumber = sessionStorage.getItem("currentPhoneNumber");
      if (!phoneNumber) return null;
      const spinData = getSpinData();
      return spinData[phoneNumber] || null;
    }

    function updateSpinCounter() {
      const userSpins = getCurrentUserSpins();
      const counterElement = document.getElementById("spinCounter");
      if (userSpins && counterElement) {
        counterElement.textContent = `C√≤n l·∫°i: ${userSpins.spinsLeft} l∆∞·ª£t`;
      }
    }

    document.getElementById("preSpinForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const userName = document.getElementById("userName").value.trim();
      const phoneNumber = document.getElementById("phoneNumber").value.trim();
      const spinLimit = parseInt(document.getElementById("spinLimit").value);

      // Validate input fields
      if (!userName || !phoneNumber || isNaN(spinLimit) || spinLimit <= 0) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói',
          text: 'Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin h·ª£p l·ªá (t√™n, s·ªë ƒëi·ªán tho·∫°i, s·ªë l∆∞·ª£t quay ph·∫£i l·ªõn h∆°n 0)!',
        });
        console.error('Validation failed: userName:', userName, 'phoneNumber:', phoneNumber, 'spinLimit:', spinLimit);
        return;
      }

      // Validate phone number format (10 digits)
      const phonePattern = /^[0-9]{10}$/;
      if (!phonePattern.test(phoneNumber)) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói',
          text: 'S·ªë ƒëi·ªán tho·∫°i ph·∫£i g·ªìm 10 ch·ªØ s·ªë v√† kh√¥ng ch·ª©a k√Ω t·ª± ƒë·∫∑c bi·ªát!',
        });
        console.error('Invalid phone number format:', phoneNumber);
        return;
      }

      // Check session storage availability
      try {
        const testKey = '__test__';
        sessionStorage.setItem(testKey, testKey);
        sessionStorage.removeItem(testKey);
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói h·ªá th·ªëng',
          text: 'Kh√¥ng th·ªÉ truy c·∫≠p b·ªô nh·ªõ tr√¨nh duy·ªát. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c li√™n h·ªá h·ªó tr·ª£!',
        });
        console.error('Session storage error:', error);
        return;
      }

      // Check if phone number already exists
      const spinData = getSpinData();
      if (spinData[phoneNumber]) {
        Swal.fire({
          icon: 'error',
          title: 'S·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng',
          text: 'S·ªë ƒëi·ªán tho·∫°i n√†y ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω. Vui l√≤ng s·ª≠ d·ª•ng s·ªë ƒëi·ªán tho·∫°i kh√°c!',
        });
        console.warn('Duplicate phone number detected:', phoneNumber);
        return; // Stop execution here to prevent further processing
      }

      // Store user data and proceed only if no duplicate
      try {
        sessionStorage.setItem("currentPhoneNumber", phoneNumber);
        sessionStorage.setItem("currentUserName", userName);

        // Initialize spin data
        spinData[phoneNumber] = {
          name: userName,
          spinsLeft: spinLimit,
          totalSpins: spinLimit
        };
        setSpinData(spinData);

        // Clear previous prizes
        sessionStorage.removeItem("wonPrizes");

        // Show wheel, hide form
        document.getElementById("preSpinForm").style.display = "none";
        document.getElementById("wrapper").style.display = "block";
        updateSpinCounter();

        console.log(`Initialized user ${userName} (${phoneNumber}) with ${spinLimit} spins`);
      } catch (error) {
        Swal.fire({
          icon: 'error',
          title: 'L·ªói h·ªá th·ªëng',
          text: 'ƒê√£ x·∫£y ra l·ªói khi l∆∞u d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i!',
        });
        console.error('Error during form submission:', error);
      }
    });

    document.addEventListener("DOMContentLoaded", async function () {
      const initData = prizes;

      hcLuckywheel.init({
        id: "luckywheel",
        config: function (callback) {
          callback && callback(initData);
        },
        mode: "text",
        getPrize: function (callback) {
          // Check if user has spins left BEFORE spinning
          const userSpins = getCurrentUserSpins();

          if (userSpins.spinsLeft <= 0) {
            console.log("No spins left before spinning - showing out of turn modal");
            document.getElementById("popupOverlayOutOfTurn").style.display = "flex";
            document.getElementById("content").classList.add("blur");
            return;
          }

          console.log(`User has ${userSpins.spinsLeft} spins left before spinning`);

          var rand = randomIndex(initData);
          var chances = rand !== null ? rand : 0;
          callback && callback([rand, chances]);
        },
        gotBack: function (data) {
          if (data) {
            const userSpins = getCurrentUserSpins();
            if (!userSpins || userSpins.spinsLeft <= 0) {
              console.log("No spins left - this shouldn't happen");
              return;
            }

            let wonPrizes = JSON.parse(sessionStorage.getItem("wonPrizes")) || [];
            wonPrizes.push(data);
            sessionStorage.setItem("wonPrizes", JSON.stringify(wonPrizes));

            const prizeText = wonPrizes.map(prize => prize.text).join(", ");
            document.getElementById("prizeText").textContent = prizeText;
            document.getElementById("prizeImage").src = data.img;
            document.getElementById("151499827-1").value = prizeText;

            // Decrement spins AFTER showing result
            const spinData = getSpinData();
            const phoneNumber = sessionStorage.getItem("currentPhoneNumber");
            spinData[phoneNumber].spinsLeft -= 1;
            setSpinData(spinData);

            const remainingSpins = spinData[phoneNumber].spinsLeft;
            console.log(`Spins remaining after this spin: ${remainingSpins}`);

            // Update counter
            updateSpinCounter();

            // Show confetti
            confetti({
              zIndex: 99999,
              particleCount: 500,
              startVelocity: 30,
              spread: 360,
            });

            // Show appropriate modal
            showPrizeModal(data, remainingSpins);
          }
        }
      });
    }, false);

    function showPrizeModal(data, remainingSpins) {
      // Show prize information
      document.getElementById("popupInformation-1-1").style.display = "block";
      document.getElementById("popupInformation-1-2").style.display = "block";

      const fillFormBtn = document.getElementById("fillFormBtn");
      const spinAgainBtn = document.getElementById("spinAgainBtn");

      // Logic for button display:
      // - If this was the last spin (remainingSpins = 0): show Fill Form button
      // - If there are still spins left (remainingSpins > 0): show Spin Again button
      if (remainingSpins === 0) {
        fillFormBtn.style.display = "block";
        spinAgainBtn.style.display = "none";
        console.log("Last spin completed - showing Fill Form button");
      } else {
        fillFormBtn.style.display = "none";
        spinAgainBtn.style.display = "block";
        console.log(`${remainingSpins} spins remaining - showing Spin Again button`);
      }

      document.getElementById("popupOverlay").style.display = "flex";
      document.getElementById("content").classList.add("blur");
    }

    function closeModal() {
      document.getElementById("prizeImage").classList.remove("rotate");
      document.getElementById("popupOverlay").style.display = "none";
      document.getElementById("popupOverlayOutOfTurn").style.display = "none";
      document.getElementById("popupOverlayOutOfQuantity").style.display = "none";
      document.getElementById("content").classList.remove("blur");
    }

    function spinAgain() {
      closeModal();
      // Small delay to ensure modal is closed before next spin
      setTimeout(() => {
        document.querySelector(".hc-luckywheel-btn").click();
      }, 100);
    }

    function showForm() {
      document.getElementById("popupInformation-1-1").style.display = "none";
      document.getElementById("popupInformation-1-2").style.display = "none";
      document.getElementById("bootstrapForm-1").style.display = "block";

      // Pre-fill form with user data
      const userName = sessionStorage.getItem("currentUserName");
      const phoneNumber = sessionStorage.getItem("currentPhoneNumber");

      if (userName) {
        document.getElementById("919986610").value = userName;
      }
      if (phoneNumber) {
        document.getElementById("1469647055").value = phoneNumber;
      }
    }

    function randomIndex(prizes) {
      const userSpins = getSpinData();
      if (!userSpins || userSpins.spinsLeft <= 0) {
        console.log("No spins available for random selection");
        return null;
      }
      let availablePrizes = prizes.filter(prize => prize.number > 0);
      if (availablePrizes.length === 0) {
        console.log("No available prizes");
        return null;
      }
      let rand = Math.floor(Math.random() * availablePrizes.length);
      return prizes.indexOf(availablePrizes[rand]);
    }

    function playAudio(id) {
      const audio = document.querySelector(id);
      if (audio) {
        audio.play().catch(error => {
          console.warn(`Failed to play audio ${id}:`, error);
        });
      }
    }

    function pauseAudio(id) {
      const audio = document.querySelector(id);
      if (audio) {
        audio.pause();
      }
    }
  </script>
</body>

</html>